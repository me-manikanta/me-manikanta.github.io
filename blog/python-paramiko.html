<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/30802d98e611b33f.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/30802d98e611b33f.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3025b315e882f27d.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-1e4088312274f55b.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-a4a49e9529d65aa6.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/605040ef-700e6facdebe043a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-f48a6b8f78dcec43.js" defer="" crossorigin=""></script><script src="/_next/static/jVMGW6uFD5AaT1Qfg3kjd/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/jVMGW6uFD5AaT1Qfg3kjd/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="dark"><div class="min-h-screen bg-gray-900"><div class="max-w-6xl mx-auto px-8 py-8"><div class="flex flex-col lg:flex-row lg:gap-16"><main id="skip" class="flex-1 max-w-4xl"><div class="w-full prose dark:prose-dark mx-auto"><h1 class="text-center mb-1">How-to: Python Paramiko</h1><hr class="mt-4"/><article><h1>Background</h1><p>I recently had a task that required me to connect to an SFTP server, download particular files (if they existed), and then process the contents. We were given the option of using any language to fulfil the criteria, so I chose Python to tackle the problem. This blog outlines the problems I encountered when attempting to build the script, as well as a tutorial on how to use the library.</p><h2>Why not an alternative lib something like <code>pysftp</code></h2><p><a href="https://stackoverflow.com/questions/48434941/pysftp-vs-paramiko">This</a> StackOverflow answer lists the differences between the libraries.</p><h1>Requirements</h1><h2>Verify Python</h2><p>We need to have some version of python installed in our machine to use the library, in my case I am currently using <code>python 3.8</code>.</p><h2>Install Paramiko</h2><p>Run the following command in the terminal to install the <code>paramiko</code> library globally</p><pre data-language="sh">pip install paramiko
</pre><h2>SFTP Server</h2><p>It is suggested that we have an SFTP server up and running in order to test the script. Our server can assist us in configuring the setup to our liking.</p><p>If you do not want to set up or have an SFTP server to test on, we can utilise several publicly available servers. A list of servers may be found <a href="https://www.sftp.net/public-online-sftp-servers">here</a>.</p><h1>How to use the library</h1><p>Now let&#x27;s start discussing how to use the library. We&#x27;ll be talking about the following in upcoming sections.</p><ul><li>Connecting to the remote server</li><li>Executing commands on the server</li><li>Transferring files (Upload/Download)</li><li>The final script</li></ul><h2>Connecting to the remote server</h2><p>First let&#x27;s define the constants for connection properties like hostname, username, password, public key, private key etc.., In a real-world application, these properties should come from a configuration file/system.</p><pre data-language="python"># There might be others based on the SFTP configuration
HOST_NAME = &quot;test.rebex.net&quot;
USER_NAME = &quot;demo&quot;
PASSWORD = &quot;password&quot;
PRIVATE_KEY_FILE = &#x27;/some/file/path/private_key.txt&#x27;
PORT = 22
</pre><p>To connect to the server we create an instance <code>client</code> of <code>paramiko.SSHClient()</code>. <a href="https://docs.paramiko.org/en/stable/api/client.html">Paramiko.SSHClient</a> is the primary class used to make connections to the remote server and execute commands. This class wraps <a href="https://docs.paramiko.org/en/stable/api/transport.html">Transport</a>, <a href="https://docs.paramiko.org/en/stable/api/channel.html">Channel</a>, and <a href="https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient">SFTPClient</a> to take care of most(not all as discussed below) aspects of authenticating and opening channels. The creation of an SSHClient object allows establishing server connections via the <a href="https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect"><code>connect()</code></a> method.</p><h2>Password-based auth</h2><pre data-language="python">client = paramiko.SSHClient()
client.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, password=PASSWORD)
</pre><p><a href="https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect"><code>connect()</code></a> method has support for a wide variety of ways to authenticate before connecting to the server for a user. The above-mentioned method is for password-based authentication.</p><p>For private key-based auth, instead of passing the password parameter, we can instead pass <code>pkey</code> an object of type <a href="https://docs.paramiko.org/en/stable/api/keys.html#paramiko.pkey.PKey">PKey</a> or <code>key_filename</code> the list of private key file names.</p><h2>Private key-based auth</h2><pre data-language="python"># Passing the PKey object
client = paramiko.SSHClient()
pkey = paramiko.RSAKey.from_private_key_file(PRIVATE_KEY_FILE)
client.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, pkey=pkey)

# Passing private key file path
client = paramiko.SSHClient()
client.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, key_filename=PRIVATE_KEY_FILE)
</pre><p>However, <a href="https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect"><code>connect()</code></a> method doesn&#x27;t support 2-Factor authentication. Following are a few examples where the above method might not work.</p><ul><li>SFTP server is enabled with both password and private key-based auth.</li><li>SFTP server needs an OTP post entering the password to login into the server.</li></ul><p>For use cases like these instead of creating an object of <a href="https://docs.paramiko.org/en/stable/api/client.html">Paramiko.SSHClient</a> we can create <a href="https://docs.paramiko.org/en/stable/api/transport.html">Paramiko.Transport</a> instead. Transport method has a support to authenticate the connection after successful negotiation by the methods like <a href="https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_password">auth_password</a>, <a href="https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_publickey">auth_publickey</a>, <a href="https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive">auth_interactive</a> etc..,</p><h3>Password and Private key-based auth</h3><p>Following are a few sample code snippets for the usage of above mentioned methods</p><pre data-language="python">transport = paramiko.Transport()
transport.start_client()
transport.auth_password(USER_NAME, PASSWORD)
pkey = paramiko.RSAKey.from_private_key_file(PRIVATE_KEY_FILE)
transport.auth_publickey(USER_NAME, pkey)
</pre><h3>Password and OTP based auth</h3><p>Here we use <a href="https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive"><code>auth_interactive</code></a> method which accepts a handler for passing the values to the prompt. The custom handler that we write has the logic to pass the OTP or Password etc.. based on the output in the prompt. If we want to get the input to the handler from <code>stdin</code> instead then we can use the <a href="https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive_dumb"><code>auth_interactive_dumb</code></a> method.</p><pre data-language="python">transport = paramiko.Transport()
transport.start_client()
transport.auth_interactive(username, handler)

def handler(self, title, instructions, prompt_list):
        answers = []
        for prompt_, _ in prompt_list:
            prompt = prompt_.strip().lower()
            if prompt.startswith(&#x27;password&#x27;):
                answers.append(PASSWORD)
            elif prompt.startswith(&#x27;verification&#x27;):
                answers.append(OTP)
            else:
                raise ValueError(&#x27;Unknown prompt: {}&#x27;.format(prompt_))
        return answers

</pre><h1>Executing commands on the server</h1><p>After we have successfully logged into the server by any one of the above-mentioned methods executing the commands is as simple as passing your command to <a href="https://docs.paramiko.org/en/2.9/api/client.html#paramiko.client.SSHClient.exec_command">exec_command</a>.</p><pre data-language="python">command = &quot;ls -l&quot;
stdin, stdout, stderr = client.exec_command(command)
print(stdout.read())
</pre><p>However paramiko has some very useful util methods to run SFTP commands on the server, following are a few of them</p><pre data-language="python">sftp_client = client.open_sftp()
sftp_client.chdir() # Changing the directory
sftp_client.cwd() # Get the current working directory
sftp_client.listdir() # List all the contents of the current working directory
</pre><p>For other supported commands, we can refer to <a href="https://docs.paramiko.org/en/stable/api/sftp.html">this documentation</a>.</p><h1>File Transfers</h1><p>Paramiko allows to programmatically send and receive files using the SFTP protocol. To upload/download file we need to create an <a href="https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient"><code>SFTPClient</code></a> session object by calling <a href="https://docs.paramiko.org/en/stable/api/client.html?highlight=open_sftp#paramiko.client.SSHClient.open_sftp"><code>open_sftp()</code></a>. This object allows to perform common SFTP operations like <a href="https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient.get"><code>get()</code></a>, <a href="https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient.put"><code>put()</code></a>.</p><h2>Upload File</h2><pre data-language="python">sftp_client= client.open_sftp()
sftp_client.put(uploadlocalfilepath,uploadremotefilepath)
sftp_client.close()
</pre><h2>Download File</h2><pre data-language="python">sftp_client= client.open_sftp()
sftp_client.get(downloadremotefilepath,downloadlocalfilepath)
sftp_client.close()
</pre><h1>The final script</h1><p>Navigate to <a href="https://gist.github.com/me-manikanta/aa9e0fd11ba2757521b6e1c5265ac29a#file-paramiko_example-py">this link</a> for the gist of the following script. Star ⭐️ the gist if it helped you.</p><h1>References</h1><ul><li>Official Paramiko <a href="https://docs.paramiko.org/en/stable/#">documentation</a> can be a good start for exploring other features of the library</li><li><a href="https://stackoverflow.com/questions/48434941/pysftp-vs-paramiko">pysftp vs paramiko</a></li><li>[SSH using Python Paramiko](SSH using Python Paramiko)</li></ul></article></div></main><aside class="lg:w-48 lg:flex-shrink-0 mt-8 lg:mt-0"><div class="lg:sticky lg:top-8"><nav class="flex flex-col space-y-2 text-right"><a class="text-gray-400 hover:text-gray-200 block py-1 text-sm transition-colors whitespace-nowrap" href="/">about</a><a class="text-gray-400 hover:text-gray-200 block py-1 text-sm transition-colors whitespace-nowrap" href="/blog">writing</a><a class="text-gray-400 hover:text-gray-200 block py-1 text-sm transition-colors whitespace-nowrap" href="/snippets">snippets</a><a href="https://www.linkedin.com/in/manikantainugurthi/" target="_blank" rel="noopener noreferrer" class="block py-1 text-sm text-gray-400 hover:text-gray-200 transition-colors whitespace-nowrap">follow ↗</a><a href="https://github.com/me-manikanta" target="_blank" rel="noopener noreferrer" class="block py-1 text-sm text-gray-400 hover:text-gray-200 transition-colors whitespace-nowrap">code ↗</a></nav></div></aside></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontMatter":{"title":"How-to: Python Paramiko","date":"March 6, 2022","description":"A how-to guide for using the Python Paramiko library."},"slug":"python-paramiko","content":"\n# Background\n\nI recently had a task that required me to connect to an SFTP server, download particular files (if they existed), and then process the contents. We were given the option of using any language to fulfil the criteria, so I chose Python to tackle the problem. This blog outlines the problems I encountered when attempting to build the script, as well as a tutorial on how to use the library.\n\n## Why not an alternative lib something like `pysftp`\n\n[This](https://stackoverflow.com/questions/48434941/pysftp-vs-paramiko) StackOverflow answer lists the differences between the libraries.\n\n# Requirements\n\n## Verify Python\n\nWe need to have some version of python installed in our machine to use the library, in my case I am currently using `python 3.8`.\n\n## Install Paramiko\n\nRun the following command in the terminal to install the `paramiko` library globally\n\n```sh\npip install paramiko\n```\n\n## SFTP Server\n\nIt is suggested that we have an SFTP server up and running in order to test the script. Our server can assist us in configuring the setup to our liking.\n\nIf you do not want to set up or have an SFTP server to test on, we can utilise several publicly available servers. A list of servers may be found [here](https://www.sftp.net/public-online-sftp-servers).\n\n# How to use the library\n\nNow let's start discussing how to use the library. We'll be talking about the following in upcoming sections.\n\n- Connecting to the remote server\n- Executing commands on the server\n- Transferring files (Upload/Download)\n- The final script\n\n## Connecting to the remote server\n\nFirst let's define the constants for connection properties like hostname, username, password, public key, private key etc.., In a real-world application, these properties should come from a configuration file/system.\n\n```python\n# There might be others based on the SFTP configuration\nHOST_NAME = \"test.rebex.net\"\nUSER_NAME = \"demo\"\nPASSWORD = \"password\"\nPRIVATE_KEY_FILE = '/some/file/path/private_key.txt'\nPORT = 22\n```\n\nTo connect to the server we create an instance `client` of `paramiko.SSHClient()`. [Paramiko.SSHClient](https://docs.paramiko.org/en/stable/api/client.html) is the primary class used to make connections to the remote server and execute commands. This class wraps [Transport](https://docs.paramiko.org/en/stable/api/transport.html), [Channel](https://docs.paramiko.org/en/stable/api/channel.html), and [SFTPClient](https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient) to take care of most(not all as discussed below) aspects of authenticating and opening channels. The creation of an SSHClient object allows establishing server connections via the [`connect()`](https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect) method.\n\n## Password-based auth\n\n```python\nclient = paramiko.SSHClient()\nclient.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, password=PASSWORD)\n```\n\n[`connect()`](https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect) method has support for a wide variety of ways to authenticate before connecting to the server for a user. The above-mentioned method is for password-based authentication.\n\nFor private key-based auth, instead of passing the password parameter, we can instead pass `pkey` an object of type [PKey](https://docs.paramiko.org/en/stable/api/keys.html#paramiko.pkey.PKey) or `key_filename` the list of private key file names.\n\n## Private key-based auth\n\n```python\n# Passing the PKey object\nclient = paramiko.SSHClient()\npkey = paramiko.RSAKey.from_private_key_file(PRIVATE_KEY_FILE)\nclient.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, pkey=pkey)\n\n# Passing private key file path\nclient = paramiko.SSHClient()\nclient.connect(hostname=HOST_NAME, port=PORT, username=USER_NAME, key_filename=PRIVATE_KEY_FILE)\n```\n\nHowever, [`connect()`](https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.connect) method doesn't support 2-Factor authentication. Following are a few examples where the above method might not work.\n\n- SFTP server is enabled with both password and private key-based auth.\n- SFTP server needs an OTP post entering the password to login into the server.\n\nFor use cases like these instead of creating an object of [Paramiko.SSHClient](https://docs.paramiko.org/en/stable/api/client.html) we can create [Paramiko.Transport](https://docs.paramiko.org/en/stable/api/transport.html) instead. Transport method has a support to authenticate the connection after successful negotiation by the methods like [auth_password](https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_password), [auth_publickey](https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_publickey), [auth_interactive](https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive) etc..,\n\n### Password and Private key-based auth\n\nFollowing are a few sample code snippets for the usage of above mentioned methods\n\n```python\ntransport = paramiko.Transport()\ntransport.start_client()\ntransport.auth_password(USER_NAME, PASSWORD)\npkey = paramiko.RSAKey.from_private_key_file(PRIVATE_KEY_FILE)\ntransport.auth_publickey(USER_NAME, pkey)\n```\n\n### Password and OTP based auth\n\nHere we use [`auth_interactive`](https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive) method which accepts a handler for passing the values to the prompt. The custom handler that we write has the logic to pass the OTP or Password etc.. based on the output in the prompt. If we want to get the input to the handler from `stdin` instead then we can use the [`auth_interactive_dumb`](https://docs.paramiko.org/en/stable/api/transport.html#paramiko.transport.Transport.auth_interactive_dumb) method.\n\n```python\ntransport = paramiko.Transport()\ntransport.start_client()\ntransport.auth_interactive(username, handler)\n\ndef handler(self, title, instructions, prompt_list):\n        answers = []\n        for prompt_, _ in prompt_list:\n            prompt = prompt_.strip().lower()\n            if prompt.startswith('password'):\n                answers.append(PASSWORD)\n            elif prompt.startswith('verification'):\n                answers.append(OTP)\n            else:\n                raise ValueError('Unknown prompt: {}'.format(prompt_))\n        return answers\n\n```\n\n# Executing commands on the server\n\nAfter we have successfully logged into the server by any one of the above-mentioned methods executing the commands is as simple as passing your command to [exec_command](https://docs.paramiko.org/en/2.9/api/client.html#paramiko.client.SSHClient.exec_command).\n\n```python\ncommand = \"ls -l\"\nstdin, stdout, stderr = client.exec_command(command)\nprint(stdout.read())\n```\n\nHowever paramiko has some very useful util methods to run SFTP commands on the server, following are a few of them\n\n```python\nsftp_client = client.open_sftp()\nsftp_client.chdir() # Changing the directory\nsftp_client.cwd() # Get the current working directory\nsftp_client.listdir() # List all the contents of the current working directory\n```\n\nFor other supported commands, we can refer to [this documentation](https://docs.paramiko.org/en/stable/api/sftp.html).\n\n# File Transfers\n\nParamiko allows to programmatically send and receive files using the SFTP protocol. To upload/download file we need to create an [`SFTPClient`](https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient) session object by calling [`open_sftp()`](https://docs.paramiko.org/en/stable/api/client.html?highlight=open_sftp#paramiko.client.SSHClient.open_sftp). This object allows to perform common SFTP operations like [`get()`](https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient.get), [`put()`](https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient.put).\n\n## Upload File\n\n```python\nsftp_client= client.open_sftp()\nsftp_client.put(uploadlocalfilepath,uploadremotefilepath)\nsftp_client.close()\n```\n\n## Download File\n\n```python\nsftp_client= client.open_sftp()\nsftp_client.get(downloadremotefilepath,downloadlocalfilepath)\nsftp_client.close()\n```\n\n# The final script\n\nNavigate to [this link](https://gist.github.com/me-manikanta/aa9e0fd11ba2757521b6e1c5265ac29a#file-paramiko_example-py) for the gist of the following script. Star ⭐️ the gist if it helped you.\n\n# References\n\n- Official Paramiko [documentation](https://docs.paramiko.org/en/stable/#) can be a good start for exploring other features of the library\n- [pysftp vs paramiko](https://stackoverflow.com/questions/48434941/pysftp-vs-paramiko)\n- [SSH using Python Paramiko](SSH using Python Paramiko)\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"python-paramiko"},"buildId":"jVMGW6uFD5AaT1Qfg3kjd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>